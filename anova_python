import pandas as pd
import statsmodels.api as sm
from statsmodels.formula.api import ols
import dataiku
# Load dataset from Dataiku
df = dataiku.Dataset("test_results_prepared_joined").get_dataframe()
# Fit model: assuming 'operator_id' is a categorical variable
model = ols('Q("Pore Size (um)") ~ C(Q("Operator"))', data=df).fit()
# Perform ANOVA
anova_table = sm.stats.anova_lm(model, typ=2)
print(anova_table)
# Write the ANOVA results to the output dataset
anova = dataiku.Dataset("anova")
anova.write_with_schema(anova_table.reset_index())
